# React Compiler 導入判断ガイド (Next.js 16+)

## 概要
React Compiler は、コンポーネントのレンダリング最適化を自動化するための仕組みです。  
`useMemo` や `useCallback` を手動で記述しなくても、再レンダー抑制が期待できます。

Next.js では SWC に統合された最適化により、対象ファイルのみコンパイルされ、  
ビルド速度への悪影響が小さく抑えられています。

---

## `reactCompiler: true` にするメリット / デメリット

### ✅ メリット
- 自動でレンダリング最適化（手動最適化コードが減る）
- Next.js 統合によりオーバーヘッドが小さい
- 将来の標準的な構成に近い形で運用できる
- 大規模アプリほど恩恵が大きい

### ⚠️ デメリット
- ビルドがわずかに遅くなる可能性
- 稀に最適化による挙動差が発生する可能性
- 導入初期は検証コストが発生し得る

---

## `reactCompiler: false` にするメリット / デメリット

### ✅ メリット
- 挙動がこれまで通りで安定
- デバッグ時にコンパイラの影響を考慮する必要がない
- 新要素に対する検証・学習コストが不要

### ⚠️ デメリット
- 手動での memo 化判断が必要
- 将来の最適化潮流に遅れる可能性
- 不要な最適化コードの記述が残る

---

## 推奨判断

| 状況 | 推奨設定 |
|------|----------|
| 新規開発 / プロダクション前 | `reactCompiler: true` |
| 既存大規模プロダクション | `false` で維持 or `annotation` で一部導入 |
| パフォーマンス課題を抱える | `true` または `annotation` を検討 |

---

## Annotation モード (Opt-in)

```ts
// next.config.ts
export default {
  reactCompiler: {
    compilationMode: 'annotation',
  },
}
````

適用箇所で明示：

```tsx
'use memo'      // 最適化を有効化
'use no memo'   // このコンポーネントでは無効化
```

---

## 結論

新規構築 / PoC / 早期段階なら **`true` での導入が推奨**。
既存運用中なら **段階導入 (`annotation`)** により安全に移行可能。
